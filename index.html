<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>æ–å‰‘ä¼ è¯´ Â· å•ä»·æ€§ä»·æ¯”è®¡ç®—</title>

<style>
:root{
  --bg:#0b1220;
  --card-bg:#1a2545; /* æ·±è“å¡ç‰‡èƒŒæ™¯ */
  --input-bg:#0f172b; /* è¾“å…¥æ¡†èƒŒæ™¯ */
  --gold:#e8c77a;     /* é‡‘è‰²æ–‡å­— */
  --cyan:#6fd3ff;     /* äº®è“æ ‡é¢˜ */
  --text:#e5edff;     /* æ™®é€šæ–‡å­— */
  --green:#00e09e;    /* æ¨èç»¿è‰² */
  --red:#ff6b6b;      /* äºæŸçº¢è‰² */
}

*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(1200px 600px at 50% -200px,#22315a,#0b1220);
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC",sans-serif;
  color:var(--text);
  padding: 20px 15px;
}

.container{ max-width: 450px; margin: 0 auto; }

h1 {
    text-align: center;
    color: var(--gold);
    font-size: 20px;
    margin-bottom: 25px;
    letter-spacing: 1px;
}

/* å¡ç‰‡é€šç”¨æ ·å¼ */
.card {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.05);
    position: relative;
}

/* æ ‡é¢˜æ  */
.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}
.card-title {
    color: var(--cyan);
    font-size: 16px;
    font-weight: bold;
}

/* è¾“å…¥æ¡†ç»„ */
.input-group { margin-bottom: 12px; }
.label { font-size: 12px; color: #889ec5; margin-bottom: 5px; }
input {
    width: 100%;
    background: var(--input-bg);
    border: 1px solid #2b3a55;
    color: #fff;
    padding: 12px;
    border-radius: 10px;
    font-size: 16px;
    outline: none;
    transition: 0.2s;
}
input:focus { border-color: var(--gold); }

/* æŒ‰é’® */
.btn-main {
    width: 100%;
    background: linear-gradient(135deg, #e8c77a, #cfa24a);
    color: #2a1f00;
    font-weight: bold;
    padding: 14px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    margin-top: 10px;
    cursor: pointer;
}
.btn-add {
    width: 100%;
    background: transparent;
    border: 1px dashed #4a5b80;
    color: #889ec5;
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 20px;
}
.btn-del {
    color: var(--red);
    font-size: 12px;
    background: none;
    border: none;
    padding: 5px;
}

/* ç»“æœå±•ç¤ºåŒº */
#resultArea { margin-top: 30px; display: none; }
.result-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}
.result-item:last-child { border: none; }

.r-left h3 { margin: 0 0 4px 0; font-size: 15px; }
.r-left span { font-size: 12px; color: #889ec5; }

.r-right { text-align: right; }
.unit-price { font-size: 20px; font-weight: bold; color: var(--gold); }
.unit-label { font-size: 10px; color: #889ec5; }

/* å† å†›æ ‡è®° */
.winner { position: relative; }
.winner::after {
    content: "æœ€åˆ’ç®—";
    position: absolute;
    top: 0; right: 0;
    background: var(--green);
    color: #000;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
}
.tag-loss {
    font-size: 11px;
    color: var(--red);
    background: rgba(255, 107, 107, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 5px;
}

</style>
</head>
<body>

<div class="container">
    <h1>ğŸ’ æ–å‰‘ä¼ è¯´ Â· é‡‡è´­å†³ç­–å™¨</h1>

    <div class="card" style="border: 1px solid #4a5b80;">
        <div class="card-header">
            <span class="card-title">ğŸ›’ æ–¹å¼Aï¼šç›´æ¥ä¹°çŸ³å¤´</span>
        </div>
        <div class="input-group">
            <div class="label">å¸‚åœºä»· (10ä¸ªçŸ³å¤´çš„ä»·æ ¼)</div>
            <input type="number" id="stonePrice" placeholder="ä¾‹å¦‚ï¼š52" value="52">
        </div>
    </div>

    <div id="fragList"></div>

    <button class="btn-add" onclick="addFragPlan()">+ æ·»åŠ å¦ä¸€ç§ç¢ç‰‡æ–¹æ¡ˆ</button>
    <button class="btn-main" onclick="calculate()">ğŸš€ å¼€å§‹è®¡ç®—æ€§ä»·æ¯”</button>

    <div class="card" id="resultArea">
        <div class="card-header">
            <span class="card-title" style="color:var(--gold)">ğŸ† è®¡ç®—ç»“æœ (æŒ‰å•ä»·æ’åº)</span>
        </div>
        <div id="resultContent"></div>
    </div>
</div>

<script>
// åˆå§‹åŒ–ï¼šé»˜è®¤åŠ ä¸€ä¸ªç¢ç‰‡æ–¹æ¡ˆ
window.onload = function() {
    addFragPlan(247, 2); // é»˜è®¤å¡«å…¥ä½ çš„ç¤ºä¾‹æ•°æ®
};

let planIndex = 0;

function addFragPlan(defaultPrice = '', defaultRatio = '') {
    planIndex++;
    const div = document.createElement('div');
    div.className = 'card';
    div.id = 'plan-' + planIndex;
    div.innerHTML = `
        <div class="card-header">
            <span class="card-title">ğŸ§© ç¢ç‰‡æ–¹æ¡ˆ ${planIndex}</span>
            <button class="btn-del" onclick="this.closest('.card').remove()">âœ• åˆ é™¤</button>
        </div>
        <div class="input-group">
            <div class="label">ç¢ç‰‡ä»·æ ¼ (10ä¸ªä¸€ç»„)</div>
            <input type="number" class="f-price" placeholder="ä¾‹å¦‚ï¼š300" value="${defaultPrice}">
        </div>
        <div class="input-group">
            <div class="label">1ä¸ªç¢ç‰‡èƒ½åˆ†è§£å‡ºå‡ ä¸ªçŸ³å¤´ï¼Ÿ</div>
            <input type="number" class="f-ratio" placeholder="ä¾‹å¦‚ï¼š2" value="${defaultRatio}">
        </div>
    `;
    document.getElementById('fragList').appendChild(div);
}

function calculate() {
    let results = [];

    // 1. è·å–ç›´æ¥ä¹°çŸ³å¤´çš„å•ä»·
    const sPrice = parseFloat(document.getElementById('stonePrice').value);
    if (sPrice > 0) {
        results.push({
            name: "ç›´æ¥ä¹°çŸ³å¤´",
            unitCost: sPrice / 10, // 10ä¸ªçš„ä»·æ ¼é™¤ä»¥10
            type: "stone"
        });
    }

    // 2. è·å–ç¢ç‰‡æ–¹æ¡ˆå•ä»·
    const plans = document.querySelectorAll('#fragList .card');
    plans.forEach((plan, idx) => {
        const title = plan.querySelector('.card-title').innerText;
        const pPrice = parseFloat(plan.querySelector('.f-price').value);
        const pRatio = parseFloat(plan.querySelector('.f-ratio').value);

        if (pPrice > 0 && pRatio > 0) {
            // å…¬å¼ï¼š10ä¸ªç¢ç‰‡ä»·æ ¼ / (10 * æ¯ä¸ªç¢ç‰‡äº§å‡ºçš„çŸ³å¤´é‡)
            const unitCost = pPrice / (10 * pRatio);
            results.push({
                name: title,
                unitCost: unitCost,
                type: "frag"
            });
        }
    });

    // 3. æ’åº (è¶Šå°è¶Šå¥½)
    results.sort((a, b) => a.unitCost - b.unitCost);

    // 4. æ¸²æŸ“
    const resBox = document.getElementById('resultArea');
    const resContent = document.getElementById('resultContent');
    resContent.innerHTML = '';

    if (results.length === 0) {
        alert("è¯·è‡³å°‘è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„ä»·æ ¼ï¼");
        return;
    }

    const bestPrice = results[0].unitCost;

    results.forEach((item, index) => {
        const isBest = index === 0;
        const diff = item.unitCost - bestPrice;
        // è®¡ç®—äºæŸç™¾åˆ†æ¯”
        const percent = bestPrice > 0 ? ((diff / bestPrice) * 100).toFixed(0) : 0;
        
        let html = `
            <div class="result-item ${isBest ? 'winner' : ''}">
                <div class="r-left">
                    <h3 style="color: ${isBest ? 'var(--green)' : 'var(--text)'}">
                        ${item.name}
                        ${!isBest ? `<span class="tag-loss">è´µäº†${percent}%</span>` : ''}
                    </h3>
                    <span>${item.type === 'stone' ? 'æˆå“è´­ä¹°' : 'åˆ†è§£åˆæˆ'}</span>
                </div>
                <div class="r-right">
                    <div class="unit-price" style="color:${isBest ? 'var(--green)' : 'var(--gold)'}">
                        ${item.unitCost.toFixed(2)}
                    </div>
                    <div class="unit-label">æ™¨æ˜Ÿ / æ¯ä¸ªçŸ³å¤´</div>
                </div>
            </div>
        `;
        resContent.innerHTML += html;
    });

    resBox.style.display = 'block';
    // æ»šåŠ¨åˆ°åº•éƒ¨
    resBox.scrollIntoView({ behavior: 'smooth' });
}
</script>

</body>
</html>
